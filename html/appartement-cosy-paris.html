<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appartement Cosy à Paris - AirLockUnlock</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            color: #333;
        }

        header {
            background-color: #007BFF;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        header .logo {
            display: flex;
            align-items: center;
        }

        header .logo img {
            width: 40px;
            height: 40px;
            margin-right: 10px;
        }

        header .logo span {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
        }

        header nav {
            display: flex;
            gap: 1rem;
        }

        header nav a {
            text-decoration: none;
            color: white;
            font-weight: bold;
            transition: color 0.3s;
        }

        header nav a:hover {
            color: #FFBB33;
        }

        .profile {
            position: relative;
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .profile img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid white;
            transition: transform 0.3s;
        }

        .profile img:hover {
            transform: scale(1.1);
        }

        .profile-menu {
            display: none;
            position: absolute;
            top: 60px;
            right: 0;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
            z-index: 1000;
            overflow: hidden;
        }

        .profile-menu.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        .profile-menu ul {
            list-style: none;
            padding: 10px 0;
            margin: 0;
        }

        .profile-menu ul li {
            padding: 10px 20px;
            transition: background-color 0.3s;
        }

        .profile-menu ul li:hover {
            background-color: #f0f0f0;
        }

        .profile-menu ul li a {
            text-decoration: none;
            color: #333;
            font-weight: bold;
            transition: color 0.3s;
        }

        .profile-menu ul li a:hover {
            color: #007BFF;
        }

        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        h1 {
            font-size: 2.5rem;
            color: #007BFF;
            margin-bottom: 1rem;
            text-align: center;
        }

        .property-images {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 2rem auto;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .property-images img {
            width: 100%;
            height: auto;
            object-fit: cover;
            transition: transform 0.4s ease-in-out;
            display: none;
        }

        .property-images img.active {
            display: block;
        }

        .arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            padding: 0.5rem;
            cursor: pointer;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            width: 30px;
            height: 30px;
        }

        .arrow-left {
            left: 10px;
        }

        .arrow-right {
            right: 10px;
        }

        .details {
            display: flex;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .details .left {
            flex: 2;
        }

        .details .right {
            flex: 1;
        }

        .details h2 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: #007BFF;
        }

        .details p {
            font-size: 1rem;
            color: #555;
            line-height: 1.5;
        }

        .amenities {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .amenity {
            background-color: #007BFF;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 30px;
            font-size: 1rem;
            text-align: center;
            transition: background-color 0.3s;
        }

        .amenity:hover {
            background-color: #FFBB33;
        }

        .reviews {
            margin-top: 3rem;
        }

        .reviews h2 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: #007BFF;
        }

        .review {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .review img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 50%;
            border: 2px solid #007BFF;
        }

        .review-details {
            flex: 1;
        }

        .review-details h3 {
            font-size: 1.2rem;
            color: #333;
        }

        .review-details p {
            font-size: 1rem;
            color: #555;
        }

        .reservation-form {
            background-color: #fff;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            margin: 2rem auto;
        }

        .reservation-form h2 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: #007BFF;
            text-align: center;
        }

        .reservation-form form {
            display: flex;
            flex-direction: column;
        }

        .reservation-form label {
            font-size: 1rem;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .reservation-form input {
            padding: 0.5rem;
            margin-bottom: 1rem;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
            width: 100%;
            box-sizing: border-box;
        }

        .reservation-form button {
            padding: 0.7rem;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .reservation-form button:hover {
            background-color: #FFBB33;
        }

        @media (max-width: 768px) {
            .reservation-form {
                padding: 1rem;
            }

            .reservation-form h2 {
                font-size: 1.5rem;
            }

            .reservation-form label {
                font-size: 0.9rem;
            }

            .reservation-form input {
                font-size: 0.9rem;
            }

            .reservation-form button {
                font-size: 1rem;
            }
        }

        footer {
            background-color: #007BFF;
            padding: 2rem;
            text-align: center;
            color: white;
            margin-top: 2rem;
        }

        footer a {
            color: white;
            text-decoration: none;
            font-weight: bold;
        }

        footer a:hover {
            color: #FFBB33;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <img src="img/logo (2).png" alt="Logo AirLockUnlock">
            <span>AirLockUnlock</span>
        </div>
        <nav>
            <a href="accueil.html">Accueil</a>
            <a href="appartements.html">Appartements</a>
            <a href="maisons.html">Maisons</a>
            <a href="contact.html">Contact</a>
        </nav>
        <div class="profile">
            <img src="img/profil.jpg" alt="Profil">
            <div class="profile-menu">
                <ul>
                    <li><a href="profil.html">Voir le profil</a></li>
                    <li><a href="reservations.html">Mes réservations</a></li>
                    <li><a href="parametres.html">Paramètres</a></li>
                    <li><a href="deconnexion.html">Déconnexion</a></li>
                </ul>
            </div>
        </div>
    </header>

    <div class="container">
        <h1>Appartement Cosy à Paris</h1>

        <div class="property-images">
            <button class="arrow arrow-left">&#10094;</button>
            <img src="img/appartementparis.PNG" alt="Salon Appartement Cosy Paris" class="active">
            <img src="img/chambreappartementcosyparis.avif" alt="Chambre Appartement Cosy Paris">
            <img src="img/cusineparis.webp" alt="Cuisine Appartement Cosy Paris">
            <button class="arrow arrow-right">&#10095;</button>
        </div>

        <div class="details">
            <div class="left">
                <h2>Description</h2>
                <p>Ce magnifique appartement cosy situé dans le cœur de Paris vous offre tout le confort nécessaire pour un séjour agréable. Il est parfait pour une escapade en ville, avec une chambre spacieuse, un salon lumineux, une cuisine entièrement équipée et une salle de bain moderne. De plus, l'appartement est sécurisé avec une serrure électronique, vous permettant d'accéder facilement et en toute sécurité à votre logement.</p>
                <p>À proximité des principaux monuments et attractions de Paris, cet appartement est l'endroit idéal pour explorer la ville lumière.</p>

                <div class="amenities">
                    <div class="amenity">Wi-Fi</div>
                    <div class="amenity">Climatisation</div>
                    <div class="amenity">Cuisine équipée</div>
                    <div class="amenity">Machine à laver</div>
                    <div class="amenity">Balcon</div>
                    <div class="amenity">Serrure électronique</div>
                </div>
            </div>

            <div class="right">
                <h2>Prix par nuit</h2>
                <p><strong>120 €</strong></p>
                <p><em>Réservez dès maintenant et profitez de Paris dans le confort d'un appartement cosy.</em></p>
            </div>
        </div>

        <div class="reviews">
            <h2>Avis des visiteurs</h2>

            <div class="review">
                <img src="img/bilal.jpeg" alt="Avis de client">
                <div class="review-details">
                    <h3>Bilal Taoufik</h3>
                    <p><strong>5 étoiles</strong> - "Un séjour parfait ! L'appartement est idéalement situé et très bien équipé. Nous avons adoré notre week-end à Paris !"</p>
                </div>
            </div>

            <div class="review">
                <img src="img/adel.jpeg" alt="Avis de client">
                <div class="review-details">
                    <h3>Adel Aichi</h3>
                    <p><strong>4.8 étoiles</strong> - "Très agréable, spacieux et bien décoré. Quelques petits détails à améliorer, mais globalement excellent !"</p>
                </div>
            </div>

            <div class="review">
                <img src="img/amine.png" alt="Avis de client">
                <div class="review-details">
                    <h3>Amine El Mir</h3>
                    <p><strong>4.8 étoiles</strong> - "Très agréable, spacieux et bien décoré. Quelques petits détails à améliorer, mais globalement excellent !"</p>
                </div>
            </div>

            <div class="review">
                <img src="img/lakshan.jpeg" alt="Avis de client">
                <div class="review-details">
                    <h3>Lakshan Sangaralingam</h3>
                    <p><strong>4.7 étoiles</strong> - "Un appartement charmant avec une vue magnifique. Nous reviendrons sans hésiter !"</p>
                </div>
            </div>
        </div>

        <div class="reservation-form">
            <h2>Réservez maintenant</h2>
            <form id="reservationForm">
                <label for="name">Nom:</label>
                <input type="text" id="name" name="nom" required>

                <label for="checkin">Date d'arrivée:</label>
                <input type="date" id="checkin" name="date_arrivee" required>

                <label for="checkout">Date de départ:</label>
                <input type="date" id="checkout" name="date_depart" required>

                <label for="guests">Nombre de personnes:</label>
                <input type="number" id="guests" name="nombre_personnes" min="1" required>

                <input type="hidden" name="id_bien" value="2">
                <button type="submit">Réserver</button>
            </form>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 AirLockUnlock. Tous droits réservés.</p>
        <p><a href="politique-confidentialite.html">Politique de confidentialité</a> | <a href="conditions-utilisation.html">Conditions d'utilisation</a></p>
    </footer>

    <script>
        // Récupération du token JWT depuis le localStorage
        function getToken() {
            return localStorage.getItem('token');
        }

        // Fonction pour décoder le token JWT et récupérer l'email
        function getEmailFromToken(token) {
            if (!token) return null;
            
            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                return payload.email || null;
            } catch (e) {
                console.error('Erreur lors du décodage du token:', e);
                return null;
            }
        }

        // Gestion du carrousel d'images
        const images = document.querySelectorAll('.property-images img');
        const leftArrow = document.querySelector('.arrow-left');
        const rightArrow = document.querySelector('.arrow-right');
        let currentIndex = 0;

        function showImage(index) {
            images.forEach((img, i) => {
                img.classList.remove('active');
                if (i === index) {
                    img.classList.add('active');
                }
            });
        }

        leftArrow.addEventListener('click', () => {
            currentIndex = (currentIndex - 1 + images.length) % images.length;
            showImage(currentIndex);
        });

        rightArrow.addEventListener('click', () => {
            currentIndex = (currentIndex + 1) % images.length;
            showImage(currentIndex);
        });

        // Initial display
        showImage(currentIndex);

        // Menu profil
        const profile = document.querySelector('.profile');
        const profileMenu = document.querySelector('.profile-menu');

        profile.addEventListener('click', () => {
            profileMenu.classList.toggle('active');
        });

        document.addEventListener('click', (event) => {
            if (!profile.contains(event.target) && !profileMenu.contains(event.target)) {
                profileMenu.classList.remove('active');
            }
        });

        // Form submission avec envoi d'email
        document.getElementById('reservationForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formElement = e.target;
            const formData = new FormData(formElement);
            
            // Récupérer le token et l'email du client
            const token = getToken();
            if (!token) {
                alert('Vous devez être connecté pour effectuer une réservation');
                return;
            }
            
            const userEmail = getEmailFromToken(token);
            if (!userEmail) {
                alert('Impossible de récupérer votre email. Veuillez vérifier votre connexion.');
                return;
            }
            
            // Ajouter l'email et le token aux données du formulaire
            formData.append('email', userEmail);
            formData.append('token', token);

            try {
                // Envoyer la réservation
                const reservationResponse = await fetch('http://172.16.15.63:8080/AirlockUnlock/bien/reserver.php', {
                    method: 'POST',
                    body: formData,
                });

                if (!reservationResponse.ok) {
                    throw new Error(`Erreur HTTP : ${reservationResponse.status}`);
                }

                const result = await reservationResponse.json();
                console.log("Réponse JSON :", result);

                if (result.success) {
                    // Envoyer l'email de confirmation
                    await sendConfirmationEmail(userEmail, formData);
                    alert(result.success + "\nUn email de confirmation vous a été envoyé à " + userEmail);
                } else if (result.error) {
                    alert(result.error);
                } else {
                    alert("Réponse inattendue : " + JSON.stringify(result));
                }

            } catch (error) {
                console.error('Erreur lors de la réservation:', error);
                alert('Erreur lors de la réservation : ' + error.message);
            }
        });

        // Fonction pour envoyer l'email de confirmation
        async function sendConfirmationEmail(email, formData) {
            try {
                const emailData = {
                    to: email,
                    subject: 'Confirmation de votre réservation - AirLockUnlock',
                    body: `
                        <h1>Confirmation de réservation</h1>
                        <p>Bonjour ${formData.get('nom')},</p>
                        <p>Nous vous confirmons votre réservation pour l'appartement cosy à Paris.</p>
                        <p><strong>Détails de votre réservation :</strong></p>
                        <ul>
                            <li>Date d'arrivée : ${formData.get('date_arrivee')}</li>
                            <li>Date de départ : ${formData.get('date_depart')}</li>
                            <li>Nombre de personnes : ${formData.get('nombre_personnes')}</li>
                        </ul>
                        <p>Montant total : 120 €</p>
                        <p>Merci d'avoir choisi AirLockUnlock pour votre séjour à Paris.</p>
                        <p>Cordialement,<br>L'équipe AirLockUnlock</p>
                    `,
                    token: getToken() // Ajout du token pour authentification côté serveur
                };

                const response = await fetch('http://172.16.15.63:8080/AirlockUnlock/send_email.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(emailData)
                });

                if (!response.ok) {
                    throw new Error('Erreur lors de l\'envoi de l\'email');
                }

                console.log('Email de confirmation envoyé avec succès');
            } catch (error) {
                console.error('Erreur lors de l\'envoi de l\'email:', error);
                // Ne pas alerter l'utilisateur pour ne pas perturber l'expérience
            }
        }
    </script>
</body>
</html>