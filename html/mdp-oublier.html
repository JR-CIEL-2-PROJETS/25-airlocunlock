<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AirLockUnlock - Mot de passe oublié</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet" />
<script src="https://cdn.tailwindcss.com"></script>
<style>
    body {
        font-family: 'Plus Jakarta Sans', sans-serif;
        background-image: url('img/still-life-keys-new-home.jpg');
        background-size: cover;
        background-position: center;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .header {
        background-color: rgba(70, 130, 180, 0.8);
        padding: 20px;
        border-bottom: 1px solid #e8edf3;
        color: white;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .header img {
        width: 40px;
        height: 40px;
    }
    .input-field {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid #cbd5e0;
        margin-bottom: 15px;
        font-size: 14px;
    }
    .button-primary {
        width: 100%;
        padding: 12px;
        background-color: #4682b4;
        color: white;
        border-radius: 8px;
        font-weight: bold;
        transition: background-color 0.3s;
        border: none;
        cursor: pointer;
    }
    .button-primary:hover {
        background-color: #2c5282;
    }
    .form-container {
        background-color: rgba(255, 255, 255, 0.9);
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 400px;
    }
    .section-title {
        font-size: 20px;
        font-weight: bold;
        color: #333;
        text-align: center;
        margin-bottom: 20px;
    }
    .signup-link {
        text-align: center;
        margin-top: 20px;
        font-size: 14px;
    }
    .signup-link a {
        color: #4682b4;
        font-weight: bold;
        text-decoration: none;
    }
    .signup-link a:hover {
        text-decoration: underline;
    }
    .error-message {
        color: red;
        text-align: center;
        margin-bottom: 15px;
        display: none;
    }
    .success-message {
        color: green;
        text-align: center;
        margin-bottom: 15px;
        display: none;
    }
</style>
</head>
<body>
<header class="header">
    <div class="flex items-center gap-4">
        <img src="img/logo (2).png" alt="Logo" />
        <h1 class="text-xl font-bold">AirLockUnlock</h1>
    </div>
</header>

<div class="flex justify-center items-center flex-1">
    <div class="form-container">
        <div class="section-title">Mot de passe oublié</div>

        <div id="errorMessage" class="error-message"></div>
        <div id="successMessage" class="success-message"></div>

        <form id="forgot-password-form">
            <input id="email" type="email" placeholder="Adresse e-mail" class="input-field" required />
            <button type="submit" class="button-primary">Vérifier l'email</button>
        </form>

        <form id="change-password-form" style="display:none; margin-top: 20px;">
            <input id="new-password" type="password" placeholder="Nouveau mot de passe" class="input-field" required />
            <button type="submit" class="button-primary">Changer le mot de passe</button>
        </form>

        <div class="signup-link">
            <p>Retour à la <a href="signin.html">connexion</a></p>
        </div>
    </div>
</div>

<script>
const forgotPasswordForm = document.getElementById('forgot-password-form');
const changePasswordForm = document.getElementById('change-password-form');
const errorMessage = document.getElementById('errorMessage');
const successMessage = document.getElementById('successMessage');

forgotPasswordForm.addEventListener('submit', function(event) {
    event.preventDefault();
    errorMessage.style.display = 'none';
    successMessage.style.display = 'none';

    const email = document.getElementById('email').value.trim();
    if (!email) {
        errorMessage.textContent = 'Veuillez entrer votre adresse e-mail.';
        errorMessage.style.display = 'block';
        return;
    }

    const formData = new FormData();
    formData.append('action', 'verifier_email');
    formData.append('email', email);

    fetch('https://172.16.15.74:421/AirlockUnlock/client/changer-mdp.php', {
        method: 'POST',
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === 'success') {
            successMessage.textContent = data.message;
            successMessage.style.display = 'block';
            errorMessage.style.display = 'none';

            forgotPasswordForm.style.display = 'none';
            changePasswordForm.style.display = 'block';
        } else {
            errorMessage.textContent = data.message;
            errorMessage.style.display = 'block';
        }
    })
    .catch(() => {
        errorMessage.textContent = 'Erreur lors de la communication avec le serveur.';
        errorMessage.style.display = 'block';
    });
});

changePasswordForm.addEventListener('submit', function(event) {
    event.preventDefault();
    errorMessage.style.display = 'none';
    successMessage.style.display = 'none';

    const newPassword = document.getElementById('new-password').value.trim();
    if (!newPassword) {
        errorMessage.textContent = 'Veuillez entrer un nouveau mot de passe.';
        errorMessage.style.display = 'block';
        return;
    }

    const formData = new FormData();
    formData.append('action', 'changer_mdp');
    formData.append('nouveau_mdp', newPassword);

    fetch('https://172.16.15.74:421/AirlockUnlock/client/changer-mdp.php', {
        method: 'POST',
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === 'success') {
            successMessage.textContent = data.message;
            successMessage.style.display = 'block';
            errorMessage.style.display = 'none';
            changePasswordForm.style.display = 'none';
        } else {
            errorMessage.textContent = data.message;
            errorMessage.style.display = 'block';
        }
    })
    .catch(() => {
        errorMessage.textContent = 'Erreur lors de la communication avec le serveur.';
        errorMessage.style.display = 'block';
    });
});
</script>
</body>
</html>